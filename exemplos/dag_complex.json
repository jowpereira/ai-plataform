{
  "name": "Workflow DAG Complexo",
  "description": "Um workflow DAG genérico demonstrando passos sequenciais, roteamento e uso de ferramentas.",
  "version": "1.0",
  "resources": {
    "models": {
      "gpt-4o-mini": {
        "type": "azure-openai",
        "deployment": "gpt-4o-mini"
      }
    },
    "tools": [
      {
        "id": "weather_tool",
        "path": "mock_tools.basic:consultar_clima",
        "description": "Consulta o clima de uma cidade."
      }
    ]
  },
  "agents": [
    {
      "id": "researcher",
      "role": "Pesquisador",
      "model": "gpt-4o-mini",
      "instructions": "Você é um pesquisador. Encontre informações sobre o tópico. Use a ferramenta de clima se for relevante.",
      "tools": ["weather_tool"]
    },
    {
      "id": "analyst",
      "role": "Analista",
      "model": "gpt-4o-mini",
      "instructions": "Você é um analista. Analise os dados fornecidos pelo pesquisador."
    },
    {
      "id": "reviewer",
      "role": "Revisor",
      "model": "gpt-4o-mini",
      "instructions": "Você é um revisor. Revise a análise. Se estiver boa, diga 'APROVADO'. Se precisar de mais trabalho, diga 'REJEITADO'."
    }
  ],
  "workflow": {
    "type": "dag",
    "start_step": "input_node",
    "nodes": [
      {
        "id": "input_node",
        "type": "_InputToConversation",
        "label": "Início"
      },
      {
        "id": "research_step",
        "type": "agent",
        "agent": "researcher",
        "label": "Pesquisar Tópico"
      },
      {
        "id": "analysis_step",
        "type": "agent",
        "agent": "analyst",
        "label": "Analisar Descobertas"
      },
      {
        "id": "review_step",
        "type": "agent",
        "agent": "reviewer",
        "label": "Revisar Análise"
      },
      {
        "id": "router_step",
        "type": "router",
        "label": "Ponto de Decisão",
        "config": {
            "expression": "input"
        }
      },
      {
        "id": "approved_node",
        "type": "agent",
        "agent": "analyst", 
        "label": "Aprovação Final",
        "input_template": "O relatório foi APROVADO. Resumo final: {{input}}"
      },
      {
        "id": "rejected_node",
        "type": "agent",
        "agent": "researcher",
        "label": "Retrabalho",
        "input_template": "O relatório foi REJEITADO. Por favor, pesquise novamente com base no feedback: {{input}}"
      }
    ],
    "edges": [
      {
        "source": "input_node",
        "target": "research_step"
      },
      {
        "source": "research_step",
        "target": "analysis_step"
      },
      {
        "source": "analysis_step",
        "target": "review_step"
      },
      {
        "source": "review_step",
        "target": "router_step"
      },
      {
        "source": "router_step",
        "target": "approved_node",
        "condition": "'aprovado' in str(value).lower()"
      },
      {
        "source": "router_step",
        "target": "rejected_node",
        "type": "default"
      }
    ]
  }
}